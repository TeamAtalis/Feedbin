<% cache ["profile_#{profile.id}_#{profile.profile_name}", "v4"] do %>
    <details class="profile">
        <summary class="feed-link profile-link tag-link" >
            <span class="link-inner">
                <div style="height: 20px; width: 0;"></div>
                <div class="tag-visibility-control">
                    <%= svg_tag "icon-caret" ,class: "feed-action-button feed-action-expand", size: "12x7" %>
                </div>
                <span class="collection-label-wrap profile-label-color">
                    <span class="collection-label" ><%= profile.profile_name %></span>
                </span>
                <span class="count-wrap">
                    <%= content_tag :span, '', class: 'count', data: {behavior: 'needs_count', count_group: 'byTag', count_group_id: profile.id } %>
                </span>
            </span>
        </summary>
        <div class="drawer-profile feed-drawer">
            <ul>
                <%= render partial: "tags/tag", collection: profile.tags %>
            </ul>
        </div>
    </details>
<% end %>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const profiles = document.querySelectorAll('.profile')

        profiles.forEach(profile => {

            profile.addEventListener('toggle', (e) => {
                e.preventDefault()
                
                const iconCaret = profile.querySelector('.icon-caret')
                const drawer = profile.querySelector('.drawer-profile') || profile.querySelector('.drawer-open')
                
                if (profile.open) {
                    iconCaret.classList.add('profile-open')
                    drawer.classList.replace('drawer-profile','drawer-open')
                } else {
                    iconCaret.classList.remove('profile-open')
                    drawer.classList.replace('drawer-open', 'drawer-profile')
                }
            });
        });
    })
</script>